<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Keuangan GitHub</title>
    <style>
        :root { --orange: #f39c12; --dark-gray: #555; --blue-link: #0056b3; --red: #e74c3c; --green: #27ae60; }
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f4f4; margin: 0; }
        .app-container { max-width: 480px; margin: 0 auto; background: #fff; min-height: 100vh; position: relative; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        
        /* Dashboard Atas */
        .summary-box { padding: 15px; background: #fff; border-bottom: 4px solid #eee; display: flex; gap: 10px; }
        .card { flex: 1; padding: 10px; border-radius: 6px; color: white; text-align: center; }
        .card.h { background: var(--red); }
        .card.p { background: var(--green); }
        .card small { font-size: 0.7rem; display: block; opacity: 0.9; }
        .card strong { font-size: 1rem; }

        /* Menu Utama */
        .header { padding: 15px; font-weight: bold; font-size: 1.1rem; border-bottom: 1px solid #ddd; background: #fff; }
        .menu-btn { width: 100%; padding: 18px; border: none; border-bottom: 1px solid #eee; background: #fff; text-align: left; font-size: 1rem; cursor: pointer; text-transform: uppercase; font-weight: 500; }

        /* Form Input */
        .form-area { padding: 20px; }
        .input-row { display: flex; align-items: center; margin-bottom: 10px; }
        .input-row label { width: 100px; font-size: 0.9rem; color: #444; }
        .input-row input, .input-row select { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 4px; background: #fafafa; }
        .amount-box { border: 2px solid var(--orange); border-radius: 5px; margin: 15px 0; display: flex; align-items: center; }
        .amount-box label { padding-left: 10px; width: 80px; }
        .amount-box input { border: none; flex: 1; padding: 12px; font-size: 1.1rem; font-weight: bold; outline: none; }
        .btn-main { width: 100%; padding: 15px; background: linear-gradient(to bottom, #fff, #bbb); border: 1px solid #888; border-radius: 5px; font-weight: bold; cursor: pointer; margin-top: 10px; }

        /* Table Data */
        .search-wrap { padding: 10px; }
        .search-bar { display: flex; border: 2px solid var(--orange); border-radius: 5px; padding: 8px; align-items: center; }
        .search-bar input { border: none; outline: none; width: 100%; padding-left: 10px; }
        table { width: 100%; border-collapse: collapse; }
        th { background: var(--dark-gray); color: white; padding: 10px; font-size: 0.7rem; border-right: 1px solid #777; }
        td { border-bottom: 1px solid #eee; padding: 12px 5px; text-align: center; font-size: 0.8rem; cursor: pointer; }
        .txt-blue { color: var(--blue-link); text-align: left; font-weight: bold; }
        .txt-red { color: var(--red); }

        /* Pop-up Modal */
        .modal-bg { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 100; }
        .modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #fff; width: 260px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .modal-item { padding: 18px; border-bottom: 1px solid #eee; text-align: center; font-weight: bold; cursor: pointer; color: #333; }
        .modal-item:last-child { border-bottom: none; }
        .hidden { display: none; }
    </style>
</head>
<body onload="refreshApp()">

<div class="app-container">
    <div id="view-menu">
        <div class="header">MANAJEMEN KEUANGAN</div>
        <div class="summary-box">
            <div class="card h">
                <small>Hutang</small><strong id="sum-h">Rp 0</strong>
            </div>
            <div class="card p">
                <small>Piutang</small><strong id="sum-p">Rp 0</strong>
            </div>
        </div>
        <button class="menu-btn" onclick="openPage('f-h')">TAMBAH HUTANG</button>
        <button class="menu-btn" onclick="openPage('d-h')">PEMBAYARAN HUTANG</button>
        <button class="menu-btn" onclick="openPage('f-p')">TAMBAH PIUTANG</button>
        <button class="menu-btn" onclick="openPage('d-p')">PENYETORAN PIUTANG</button>
    </div>

    <div id="view-form" class="hidden">
        <div class="header" id="form-title">INPUT</div>
        <div class="form-area">
            <div class="input-row"><label>Tanggal</label><input type="date" id="i-tgl"></div>
            <div class="input-row"><label>Jatuh Tempo</label><input type="date" id="i-tempo"></div>
            <div class="input-row"><label id="i-label-akun">Simpan ke</label><select id="i-akun"><option>1111-Kas</option></select></div>
            
            <div class="amount-box">
                <label>Jumlah</label>
                <input type="number" id="i-nilai" placeholder="0">
            </div>

            <div class="input-row"><label>Keterangan</label><input type="text" id="i-ket" placeholder="..."></div>
            
            <button class="btn-main" onclick="prosesSimpan()">SIMPAN DATA</button>
            <button class="btn-main" style="background:#eee" onclick="closePage()">BATAL</button>
        </div>
    </div>

    <div id="view-data" class="hidden">
        <div class="header" id="data-title">DATA</div>
        <div class="search-wrap">
            <div class="search-bar">üîç <input type="text" placeholder="Cari..."></div>
        </div>
        <table>
            <thead><tr><th>TANGGAL</th><th>KETERANGAN</th><th>NILAI</th><th>BAYAR</th></tr></thead>
            <tbody id="table-body"></tbody>
        </table>
        <button class="btn-main" onclick="closePage()">KEMBALI KE MENU</button>
    </div>

    <div class="modal-bg" id="modal" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-item" id="btn-bayar-text" onclick="alert('Buka Form Pembayaran...')">Bayar</div>
            <div class="modal-item">Data Rincian</div>
            <div class="modal-item" style="color:red" onclick="hapusEntry()">Hapus Transaksi</div>
        </div>
    </div>
</div>

<script>
    let currentMode = ''; 
    let activeIdx = null;

    // Fungsi format tanggal DD-MM-YYYY
    function fmtDate(isoDate) {
        if(!isoDate) return '-';
        const [y, m, d] = isoDate.split('-');
        return `${d}/${m}/${y}`;
    }

    function refreshApp() {
        const h = JSON.parse(localStorage.getItem('db_h')) || [];
        const p = JSON.parse(localStorage.getItem('db_p')) || [];
        const totalH = h.reduce((a, b) => a + (Number(b.nilai) - Number(b.bayar)), 0);
        const totalP = p.reduce((a, b) => a + (Number(b.nilai) - Number(b.bayar)), 0);
        
        document.getElementById('sum-h').innerText
