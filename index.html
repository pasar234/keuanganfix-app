<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Keuangan Mobile</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#764ba2">
    <style>
        /* RESET & BASE */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            color: #000; /* Teks lebih gelap agar kontras */
            touch-action: manipulation;
        }

        .app-container {
            max-width: 100%;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            min-height: 95vh;
        }

        /* HEADER */
        .app-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 15px;
            text-align: center;
        }

        .app-title {
            font-size: 26px; /* Diperbesar */
            font-weight: 800;
            margin-bottom: 5px;
        }

        /* NAVIGASI TABS */
        .nav-tabs {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1px;
            background: #ccc;
            padding: 1px;
        }

        .nav-btn {
            background: white;
            border: none;
            padding: 15px 5px;
            font-size: 14px; /* Diperbesar */
            font-weight: 700;
            color: #444;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .nav-btn.active {
            color: #667eea;
            background: #f0f4ff;
            border-bottom: 4px solid #667eea;
        }

        .nav-icon { font-size: 20px; }

        /* SCREENS */
        .screen { display: none; padding: 20px 15px; }
        .screen.active { display: block; }

        /* FORM - FONT BESAR */
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-size: 16px; font-weight: 700; margin-bottom: 8px; color: #222; }
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 16px; /* Lebih lebar */
            border: 2px solid #999;
            border-radius: 10px;
            font-size: 18px; /* Diperbesar */
            font-weight: 600;
            background: #fff;
            color: #000;
        }

        /* BUTTON */
        .btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 10px;
            font-size: 20px; /* Sangat besar */
            font-weight: 800;
            background: #667eea;
            color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* SUMMARY CARD */
        .summary-card {
            background: #764ba2;
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }

        .summary-amount {
            font-size: 32px; /* Diperbesar drastis */
            font-weight: 900;
            margin-top: 5px;
        }

        /* DATA DISPLAY (LIST) */
        .data-item {
            border: 2px solid #eee;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            background: #fff;
        }

        .data-header {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .tgl-tempo { font-size: 14px; color: #555; line-height: 1.4; }
        .tgl-tempo strong { font-size: 16px; color: #000; }

        .ket-text { font-size: 20px; font-weight: 800; color: #000; margin-bottom: 5px; }
        .amount-text { font-size: 24px; font-weight: 900; color: #2c3e50; }
        .sisa-text { font-size: 18px; color: #e74c3c; font-weight: 700; }

        /* SEARCH BAR */
        .search-container { margin-bottom: 15px; }
        .search-input {
            width: 100%;
            padding: 15px;
            border-radius: 25px;
            border: 2px solid #667eea;
            font-size: 18px;
            text-align: center;
        }

        /* ACTION BUTTONS */
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .action-btn {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 800;
            color: white;
            text-transform: uppercase;
        }
        .btn-pay { background: #28a745; }
        .btn-del { background: #dc3545; }

        /* RIWAYAT - RAPI & JELAS */
        .history-box {
            background: #f1f3f5;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
        }
        .history-item {
            font-size: 14px;
            padding: 5px 0;
            border-bottom: 1px solid #dee2e6;
            color: #333;
            font-weight: 600;
        }

        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #222;
            color: #fff;
            padding: 15px 25px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: bold;
            z-index: 1000;
            display: none;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="app-header">
            <div class="app-title">ðŸ’° Keuangan Mobile</div>
        </div>

        <div class="nav-tabs">
            <button class="nav-btn active" onclick="openScreen('transaksi', this)">
                <span class="nav-icon">âž•</span> Tambah
            </button>
            <button class="nav-btn" onclick="openScreen('hutang', this)">
                <span class="nav-icon">ðŸ“‰</span> Hutang
            </button>
            <button class="nav-btn" onclick="openScreen('piutang', this)">
                <span class="nav-icon">ðŸ“ˆ</span> Piutang
            </button>
            <button class="nav-btn" onclick="openScreen('backup', this)">
                <span class="nav-icon">ðŸ’¾</span> Backup
            </button>
        </div>

        <div id="transaksi" class="screen active">
            <form id="financeForm">
                <div class="form-group">
                    <label class="form-label">Jenis Transaksi</label>
                    <select id="jenis" class="form-select">
                        <option value="hutang">Hutang (Saya Pinjam)</option>
                        <option value="piutang">Piutang (Saya Pinjamin)</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Tgl Pinjam</label>
                        <input type="date" id="tanggal" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Jatuh Tempo</label>
                        <input type="date" id="jatuh_tempo" class="form-input">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Nominal Uang (Rp)</label>
                    <input type="number" id="jumlah" class="form-input" placeholder="0" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Nama / Keterangan</label>
                    <textarea id="keterangan" class="form-textarea" rows="2"></textarea>
                </div>
                <button type="submit" class="btn">SIMPAN SEKARANG</button>
            </form>
        </div>

        <div id="hutang" class="screen">
            <div class="summary-card">
                <p style="font-size: 18px; font-weight: bold;">TOTAL HUTANG</p>
                <div class="summary-amount" id="totalHutang">Rp 0</div>
            </div>
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Cari Nama..." onkeyup="filterList('listHutang', this.value)">
            </div>
            <div id="listHutang"></div>
        </div>

        <div id="piutang" class="screen">
            <div class="summary-card" style="background: #28a745;">
                <p style="font-size: 18px; font-weight: bold;">TOTAL PIUTANG</p>
                <div class="summary-amount" id="totalPiutang">Rp 0</div>
            </div>
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Cari Nama..." onkeyup="filterList('listPiutang', this.value)">
            </div>
            <div id="listPiutang"></div>
        </div>

        <div id="backup" class="screen">
            <button onclick="exportData()" class="btn" style="background: #444; margin-bottom: 30px;">ðŸ“¥ DOWNLOAD BACKUP</button>
            <label class="form-label">Restore Data (Upload File):</label>
            <input type="file" accept=".json" class="form-input" onchange="importData(event)">
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        // Tanggal otomatis hari ini
        document.getElementById('tanggal').value = new Date().toISOString().split('T')[0];

        function openScreen(id, btn) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            btn.classList.add('active');
            if(id === 'hutang' || id === 'piutang') renderData();
        }

        document.getElementById('financeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const data = {
                id: Date.now(),
                jenis: document.getElementById('jenis').value,
                tgl: document.getElementById('tanggal').value,
                tempo: document.getElementById('jatuh_tempo').value || '-',
                jumlah: parseFloat(document.getElementById('jumlah').value),
                bayar: 0,
                riwayat: [],
                ket: document.getElementById('keterangan').value || '-'
            };
            const db = JSON.parse(localStorage.getItem('keuangan_pro')) || [];
            db.push(data);
            localStorage.setItem('keuangan_pro', JSON.stringify(db));
            this.reset();
            document.getElementById('tanggal').value = new Date().toISOString().split('T')[0];
            showToast("âœ… Berhasil Disimpan");
            openScreen(data.jenis, document.querySelector(`.nav-btn[onclick*="${data.jenis}"]`));
        });

        function renderData() {
            const db = JSON.parse(localStorage.getItem('keuangan_pro')) || [];
            const listH = document.getElementById('listHutang');
            const listP = document.getElementById('listPiutang');
            listH.innerHTML = ''; listP.innerHTML = '';
            let sumH = 0, sumP = 0;

            db.sort((a,b) => b.id - a.id).forEach(item => {
                const sisa = item.jumlah - item.bayar;
                const isOver = item.tempo !== '-' && new Date(item.tempo) < new Date().setHours(0,0,0,0) && sisa > 0;
                
                const html = `
                <div class="data-item">
                    <div class="data-header">
                        <div class="tgl-tempo">PINJAM: <strong>${fmtTgl(item.tgl)}</strong></div>
                        <div class="tgl-tempo">TEMPO: <strong style="color:${isOver ? 'red' : 'black'}">${fmtTgl(item.tempo)}</strong></div>
                    </div>
                    <div class="ket-text">${item.ket}</div>
                    <div class="amount-text">${fmtRp(item.jumlah)}</div>
                    <div class="sisa-text">SISA: ${fmtRp(sisa)}</div>
                    
                    ${item.riwayat.length > 0 ? `
                        <div class="history-box">
                            ${item.riwayat.map(r => `<div class="history-item">ðŸ“… ${fmtTgl(r.tgl)}: ${fmtRp(r.nom)} (${r.met})</div>`).join('')}
                        </div>
                    ` : ''}

                    <div class="btn-group">
                        ${sisa > 0 ? `<button class="action-btn btn-pay" onclick="payItem(${item.id})">BAYAR</button>` : `<div style="color:green; font-weight:900; padding:10px; text-align:center;">LUNAS</div>`}
                        <button class="action-btn btn-del" onclick="delItem(${item.id})">HAPUS</button>
                    </div>
                </div>`;

                if(item.jenis === 'hutang') { listH.innerHTML += html; sumH += sisa; }
                else { listP.innerHTML += html; sumP += sisa; }
            });

            document.getElementById('totalHutang').textContent = fmtRp(sumH);
            document.getElementById('totalPiutang').textContent = fmtRp(sumP);
        }

        function filterList(target, val) {
            const items = document.getElementById(target).getElementsByClassName('data-item');
            const q = val.toLowerCase();
            Array.from(items).forEach(it => {
                const txt = it.querySelector('.ket-text').textContent.toLowerCase();
                it.style.display = txt.includes(q) ? 'block' : 'none';
            });
        }

        function payItem(id) {
            const db = JSON.parse(localStorage.getItem('keuangan_pro'));
            const idx = db.findIndex(i => i.id === id);
            const sisa = db[idx].jumlah - db[idx].bayar;
            const nom = prompt("Masukkan jumlah bayar:", sisa);
            if(!nom || nom <= 0) return;
            const met = prompt("Metode (Tunai/Transfer):", "Tunai");
            db[idx].bayar += parseFloat(nom);
            db[idx].riwayat.push({ tgl: new Date().toISOString().split('T')[0], nom: parseFloat(nom), met: met });
            localStorage.setItem('keuangan_pro', JSON.stringify(db));
            renderData();
        }

        function delItem(id) { if(confirm("Hapus data ini?")) { let db = JSON.parse(localStorage.getItem('keuangan_pro')); db = db.filter(i => i.id !== id); localStorage.setItem('keuangan_pro', JSON.stringify(db)); renderData(); } }
        function fmtRp(v) { return "Rp " + new Intl.NumberFormat('id-ID').format(v); }
        function fmtTgl(s) { if(s === '-') return '-'; const d = s.split('-'); return `${d[2]}/${d[1]}/${d[0]}`; }
        function showToast(m) { const t = document.getElementById('toast'); t.textContent = m; t.style.display = 'block'; setTimeout(()=>t.style.display='none', 2500); }
        
        function exportData() {
            const data = localStorage.getItem('keuangan_pro') || '[]';
            const blob = new Blob([data], {type: 'application/json'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `keuangan_backup_${Date.now()}.json`;
            a.click();
        }

        function importData(e) {
            const fr = new FileReader();
            fr.onload = (ev) => { localStorage.setItem('keuangan_pro', ev.target.result); alert("Restore Berhasil!"); location.reload(); };
            fr.readAsText(e.target.files[0]);
        }
    </script>
</body>
</html>
