<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Keuangan Mobile Pro</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#764ba2">
    <style>
        /* RESET & NATIVE FEEL */
        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
            -webkit-tap-highlight-color: transparent; 
            user-select: none;
            -webkit-user-select: none;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f0f2f5;
            min-height: 100vh;
            color: #333;
        }

        .app-container {
            max-width: 500px;
            margin: 0 auto;
            background: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* HEADER & NAV */
        .app-header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; padding: 25px 15px; text-align: center;
            position: sticky; top: 0; z-index: 1000;
        }
        
        .nav-tabs { 
            display: grid; grid-template-columns: repeat(4, 1fr); 
            background: #fff; border-bottom: 1px solid #eee;
            position: sticky; top: 72px; z-index: 999;
        }
        .nav-btn { 
            background: none; border: none; padding: 15px 5px; 
            font-size: 11px; font-weight: 700; color: #888; 
        }
        .nav-btn.active { color: #764ba2; border-bottom: 3px solid #764ba2; }

        /* SCREENS */
        .screen { display: none; padding: 20px 15px; }
        .screen.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }

        /* INPUTS & BUTTONS */
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; font-size: 14px; font-weight: 700; margin-bottom: 5px; }
        .form-input, .form-select, .form-textarea {
            width: 100%; padding: 14px; border: 1.5px solid #ddd; border-radius: 12px; 
            font-size: 16px; font-weight: 600;
        }
        .btn { 
            width: 100%; padding: 16px; border: none; border-radius: 12px; 
            font-size: 18px; font-weight: 800; background: #764ba2; color: white; 
        }
        .btn:active { transform: scale(0.96); opacity: 0.9; }

        /* CARDS & ITEMS */
        .summary-card { 
            background: linear-gradient(135deg, #764ba2, #667eea); 
            color: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; text-align: center;
        }
        .data-item { 
            border: 1px solid #eee; border-radius: 15px; padding: 15px; 
            margin-bottom: 15px; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .amount-text { font-size: 20px; font-weight: 900; color: #764ba2; }
        .sisa-text { font-size: 14px; color: #e74c3c; font-weight: 700; background: #fff0f0; padding: 4px 8px; border-radius: 5px; }

        /* RIWAYAT MINI BOX */
        .history-box { 
            margin-top: 10px; padding: 10px; background: #f9f9f9; 
            border-radius: 10px; border-left: 3px solid #28a745; font-size: 13px;
        }
        .history-item { padding: 5px 0; border-bottom: 1px solid #eee; color: #555; }
        .history-item:last-child { border: none; }

        /* MODAL & TOAST */
        #paymentModal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 2000;
        }
        .modal-content { background: white; padding: 20px; border-radius: 20px; width: 90%; max-width: 400px; }
        
        #snackbar {
            visibility: hidden; min-width: 200px; background: #333; color: #fff;
            text-align: center; border-radius: 30px; padding: 16px; position: fixed;
            left: 50%; bottom: 30px; transform: translateX(-50%); z-index: 3000;
        }
        #snackbar.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
    </style>
</head>
<body>

    <div class="app-container">
        <div class="app-header"><div class="app-title">üí∞ KEUANGAN PRO</div></div>

        <div class="nav-tabs">
            <button class="nav-btn active" onclick="openScreen('transaksi', this)">TAMBAH</button>
            <button class="nav-btn" onclick="openScreen('hutang', this)">HUTANG</button>
            <button class="nav-btn" onclick="openScreen('piutang', this)">PIUTANG</button>
            <button class="nav-btn" onclick="openScreen('backup', this)">DATA</button>
        </div>

        <div id="transaksi" class="screen active">
            <form id="financeForm">
                <div class="form-group"><label class="form-label">Jenis</label>
                    <select id="jenis" class="form-select">
                        <option value="hutang">Hutang</option>
                        <option value="piutang">Piutang</option>
                    </select>
                </div>
                <div class="form-group"><label class="form-label">Tanggal Pinjam</label>
                    <input type="date" id="tanggal" class="form-input" required>
                </div>
                <div class="form-group"><label class="form-label">Jatuh Tempo</label>
                    <input type="date" id="jatuh_tempo" class="form-input">
                </div>
                <div class="form-group"><label class="form-label">Nominal (Rp)</label>
                    <input type="number" id="jumlah" class="form-input" placeholder="0" required>
                </div>
                <div class="form-group"><label class="form-label">Nama / Keterangan</label>
                    <textarea id="keterangan" class="form-textarea" rows="2" placeholder="Contoh: Pinjaman Andi"></textarea>
                </div>
                <button type="submit" class="btn">SIMPAN DATA</button>
            </form>
        </div>

        <div id="hutang" class="screen">
            <div class="summary-card"><p>TOTAL HUTANG</p><div class="summary-amount" id="totalHutang">Rp 0</div></div>
            <div id="listHutang"></div>
        </div>

        <div id="piutang" class="screen">
            <div class="summary-card" style="background: linear-gradient(135deg, #28a745, #1e7e34);"><p>TOTAL PIUTANG</p><div class="summary-amount" id="totalPiutang">Rp 0</div></div>
            <div id="listPiutang"></div>
        </div>

        <div id="backup" class="screen">
            <button onclick="exportData()" class="btn" style="background: #444; margin-bottom: 15px;">üì• EXPORT JSON</button>
            <input type="file" accept=".json" class="form-input" onchange="importData(event)">
        </div>
    </div>

    <div id="snackbar">‚úÖ Berhasil!</div>

    <div id="paymentModal">
        <div class="modal-content">
            <h3 style="margin-bottom: 15px; text-align: center;">Bayar / Cicil</h3>
            <div class="form-group"><label class="form-label">Tanggal Bayar</label>
                <input type="date" id="payDate" class="form-input">
            </div>
            <div class="form-group"><label class="form-label">Nominal (Rp)</label>
                <input type="number" id="payAmount" class="form-input">
            </div>
            <div class="form-group"><label class="form-label">Metode</label>
                <input type="text" id="payNote" class="form-input" placeholder="Tunai/Transfer">
            </div>
            <button class="btn" onclick="confirmPayment()" style="margin-bottom:10px">SIMPAN PEMBAYARAN</button>
            <button class="btn" onclick="closeModal()" style="background:#eee; color: #444;">BATAL</button>
        </div>
    </div>

    <script>
        let currentPayId = null;
        const DB_NAME = 'keuangan_db_v3';

        document.getElementById('tanggal').value = new Date().toISOString().split('T')[0];

        function showToast(msg) {
            const x = document.getElementById("snackbar");
            x.innerText = msg; x.className = "show";
            setTimeout(() => { x.className = x.className.replace("show", ""); }, 3000);
        }

        function openScreen(id, btn) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            btn.classList.add('active');
            if(id === 'hutang' || id === 'piutang') renderData();
        }

        document.getElementById('financeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const data = {
                id: Date.now(),
                jenis: document.getElementById('jenis').value,
                tgl: document.getElementById('tanggal').value,
                tempo: document.getElementById('jatuh_tempo').value || '-',
                jumlah: parseFloat(document.getElementById('jumlah').value),
                bayar: 0,
                riwayat: [],
                ket: document.getElementById('keterangan').value || 'Tanpa Nama'
            };
            const db = JSON.parse(localStorage.getItem(DB_NAME)) || [];
            db.push(data);
            localStorage.setItem(DB_NAME, JSON.stringify(db));
            this.reset();
            showToast("‚úÖ Data Tersimpan!");
            renderData();
            openScreen(data.jenis, document.querySelector(`.nav-btn[onclick*="${data.jenis}"]`));
        });

        function renderData() {
            const db = JSON.parse(localStorage.getItem(DB_NAME)) || [];
            const listH = document.getElementById('listHutang');
            const listP = document.getElementById('listPiutang');
            listH.innerHTML = ''; listP.innerHTML = '';
            let sumH = 0, sumP = 0;

            db.sort((a,b) => b.id - a.id).forEach(item => {
                const sisa = item.jumlah - item.bayar;
                const html = `
                <div class="data-item">
                    <div style="font-size:11px; color:#999;">üìÖ ${fmtTgl(item.tgl)}</div>
                    <div style="font-weight:800; font-size:16px;">${item.ket}</div>
                    <div class="amount-text">${fmtRp(item.jumlah)}</div>
                    <div class="sisa-text">SISA: ${fmtRp(sisa)}</div>
                    
                    ${item.riwayat.length > 0 ? `
                        <div class="history-box">
                            <strong>Riwayat Bayar:</strong>
                            ${item.riwayat.map(r => `
                                <div class="history-item">üìç ${fmtTgl(r.tgl)} - ${fmtRp(r.nom)} (${r.note})</div>
                            `).join('')}
                        </div>
                    ` : ''}

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px;">
                        ${sisa > 0 ? `<button onclick="openPayModal(${item.id})" style="padding:10px; border:none; border-radius:8px; background:#28a745; color:white; font-weight:bold;">CICIL</button>` : `<div style="color:green; font-weight:bold; padding:10px;">LUNAS</div>`}
                        <button onclick="delItem(${item.id})" style="padding:10px; border:none; border-radius:8px; background:#eee; color:red;">HAPUS</button>
                    </div>
                </div>`;
                
                if(item.jenis === 'hutang') { listH.innerHTML += html; sumH += sisa; }
                else { listP.innerHTML += html; sumP += sisa; }
            });
            document.getElementById('totalHutang').textContent = fmtRp(sumH);
            document.getElementById('totalPiutang').textContent = fmtRp(sumP);
        }

        function openPayModal(id) {
            currentPayId = id;
            document.getElementById('payDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('paymentModal').style.display = 'flex';
        }

        function closeModal() { document.getElementById('paymentModal').style.display = 'none'; }

        function confirmPayment() {
            const tgl = document.getElementById('payDate').value;
            const nom = parseFloat(document.getElementById('payAmount').value);
            const note = document.getElementById('payNote').value || 'Tunai';
            if(!tgl || !nom) return showToast("‚ùå Isi data lengkap!");

            const db = JSON.parse(localStorage.getItem(DB_NAME));
            const idx = db.findIndex(i => i.id === currentPayId);
            db[idx].bayar += nom;
            db[idx].riwayat.push({ tgl, nom, note });
            
            localStorage.setItem(DB_NAME, JSON.stringify(db));
            closeModal();
            showToast("‚úÖ Cicilan Tercatat!");
            renderData();
        }

        function delItem(id) { if(confirm("Hapus data ini?")) { let db = JSON.parse(localStorage.getItem(DB_NAME)); db = db.filter(i => i.id !== id); localStorage.setItem(DB_NAME, JSON.stringify(db)); renderData(); } }
        function fmtRp(v) { return "Rp " + new Intl.NumberFormat('id-ID').format(v); }
        function fmtTgl(s) { if(!s || s === '-') return '-'; const d = s.split('-'); return `${d[2]}/${d[1]}/${d[0]}`; }
        function exportData() { const blob = new Blob([localStorage.getItem(DB_NAME)], {type: 'application/json'}); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `backup_keuangan.json`; a.click(); }
        function importData(e) { const fr = new FileReader(); fr.onload = (ev) => { localStorage.setItem(DB_NAME, ev.target.result); location.reload(); }; fr.readAsText(e.target.files[0]); }
    </script>
</body>
</html>
