<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0">
    <title>Stok Strip Pro v5.6</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e293b">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.10.3/sql-wasm.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: sans-serif; }
        body { background: #f1f5f9; height: 100vh; overflow: hidden; }
        header { background: #1e293b; color: white; padding: 15px; text-align: center; font-weight: bold; }
        nav { display: flex; background: #fff; border-bottom: 2px solid #e2e8f0; overflow-x: auto; }
        nav button { flex: 1; padding: 12px; border: none; background: none; font-weight: bold; color: #64748b; min-width: 90px; cursor: pointer; }
        nav button.active { color: #2563eb; border-bottom: 3px solid #2563eb; }
        .container { height: calc(100vh - 110px); display: flex; flex-direction: column; }
        #product-list { flex: 1; overflow-y: auto; padding: 10px; padding-bottom: 80px; }
        .card { background: #fff; border-radius: 10px; padding: 12px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); display: flex; align-items: center; gap: 12px; }
        .card img { width: 70px; height: 70px; object-fit: cover; border-radius: 8px; background: #eee; }
        .info { flex: 1; }
        .info h3 { font-size: 15px; margin-bottom: 4px; color: #334155; }
        .info p { font-weight: bold; color: #2563eb; font-size: 14px; }
        .actions { display: flex; flex-direction: column; gap: 6px; }
        .btn-edit { background: #eab308; color: white; border: none; padding: 8px 12px; border-radius: 6px; font-weight: bold; font-size: 12px; cursor: pointer; }
        .btn-hapus { background: #ef4444; color: white; border: none; padding: 8px 12px; border-radius: 6px; font-weight: bold; font-size: 12px; cursor: pointer; }
        .counter { display: flex; align-items: center; gap: 8px; margin-top: 8px; }
        .counter button { width: 32px; height: 32px; border: 1px solid #cbd5e1; border-radius: 4px; background: #fff; font-size: 18px; cursor: pointer; }
        .fab { position: fixed; bottom: 20px; right: 20px; background: #2563eb; color: white; padding: 12px 20px; border-radius: 50px; text-decoration: none; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.2); border: none; cursor: pointer; }
    </style>
</head>
<body>

<header>STOK STRIP v5.6</header>

<nav id="category-nav">
    <button class="active" onclick="filterCat('HONDA', this)">HONDA</button>
    <button onclick="filterCat('YAMAHA', this)">YAMAHA</button>
    <button onclick="filterCat('SUZUKI', this)">SUZUKI</button>
    <button onclick="filterCat('KAWASAKI', this)">KAWASAKI</button>
</nav>

<div class="container">
    <div id="product-list"></div>
</div>

<button class="fab" onclick="tambahProduk()">+ INPUT</button>

<script>
    let db;
    let currentCategory = 'HONDA';

    async function initDb() {
        try {
            const SQL = await initSqlJs({ locateFile: file => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.10.3/${file}` });
            const savedData = localStorage.getItem('stok_db');
            
            if (savedData) {
                db = new SQL.Database(new Uint8Array(JSON.parse(savedData)));
            } else {
                db = new SQL.Database();
                db.run("CREATE TABLE produk (id INTEGER PRIMARY KEY AUTOINCREMENT, nama TEXT, kategori TEXT, stok INTEGER, foto TEXT)");
            }
            tampilkanProduk();
        } catch (err) {
            console.error("Database error:", err);
            alert("Gagal memuat database.");
        }
    }

    function filterCat(cat, btn) {
        currentCategory = cat;
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        tampilkanProduk();
    }

    function tampilkanProduk() {
        const list = document.getElementById('product-list');
        list.innerHTML = '';
        
        try {
            const res = db.exec("SELECT * FROM produk WHERE kategori = ? ORDER BY id DESC", [currentCategory]);
            if (res.length > 0) {
                res[0].values.forEach(row => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `
                        <img src="${row[4] || 'https://via.placeholder.com/70'}">
                        <div class="info">
                            <h3>${row[1]}</h3>
                            <p>Stok: ${row[3]}</p>
                            <div class="counter">
                                <button onclick="updateStok(${row[0]}, 1)">+</button>
                                <button onclick="updateStok(${row[0]}, -1)">-</button>
                            </div>
                        </div>
                        <div class="actions">
                            <button class="btn-edit" onclick="editProduk(${row[0]})">EDIT</button>
                            <button class="btn-hapus" onclick="hapusProduk(${row[0]})">HAPUS</button>
                        </div>
                    `;
                    list.appendChild(card);
                });
            } else {
                list.innerHTML = '<p style="text-align:center; padding:20px; color:#64748b;">Belum ada produk di kategori ini.</p>';
            }
        } catch (e) { console.error(e); }
    }

    function updateStok(id, val) {
        db.run("UPDATE produk SET stok = stok + ? WHERE id = ?", [val, id]);
        simpanDanRefresh();
    }

    function hapusProduk(id) {
        if (confirm("Hapus produk ini secara permanen?")) {
            db.run("DELETE FROM produk WHERE id = ?", [id]);
            simpanDanRefresh();
        }
    }

    function tambahProduk() {
        const nama = prompt("Nama Produk:");
        if(nama) {
            db.run("INSERT INTO produk (nama, kategori, stok, foto) VALUES (?, ?, 0, '')", [nama, currentCategory]);
            simpanDanRefresh();
        }
    }

    function editProduk(id) {
        const baru = prompt("Ganti Nama Produk:");
        if(baru) {
            db.run("UPDATE produk SET nama = ? WHERE id = ?", [baru, id]);
            simpanDanRefresh();
        }
    }

    function simpanDanRefresh() {
        const data = db.export();
        localStorage.setItem('stok_db', JSON.stringify(Array.from(data)));
        tampilkanProduk();
    }

    initDb();
</script>
</body>
</html>
