<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0">
    <title>Stok Strip Pro v5.6</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e293b">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.10.3/sql-wasm.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: sans-serif; }
        body { background: #f1f5f9; height: 100vh; overflow: hidden; }
        header { background: #1e293b; color: white; padding: 15px; text-align: center; font-weight: bold; }
        nav { display: flex; background: #fff; border-bottom: 2px solid #e2e8f0; }
        nav button { flex: 1; padding: 12px; border: none; background: none; font-weight: bold; color: #64748b; }
        nav button.active { color: #2563eb; border-bottom: 3px solid #2563eb; }
        .container { height: calc(100vh - 110px); display: flex; flex-direction: column; }
        #product-list { flex: 1; overflow-y: auto; padding: 10px; }
        .card { background: #fff; border-radius: 10px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); display: flex; align-items: center; gap: 15px; }
        .card img { width: 60px; height: 60px; object-fit: cover; border-radius: 8px; background: #eee; }
        .info { flex: 1; }
        .actions { display: flex; flex-direction: column; gap: 5px; }
        .btn-edit { background: #eab308; color: white; border: none; padding: 6px; border-radius: 5px; font-weight: bold; cursor: pointer; }
        .btn-hapus { background: #ef4444; color: white; border: none; padding: 6px; border-radius: 5px; font-weight: bold; cursor: pointer; }
        .fab { position: fixed; bottom: 20px; right: 20px; background: #2563eb; color: white; padding: 15px 25px; border-radius: 50px; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>

<header>STOK STRIP v5.6</header>

<nav>
    <button class="active" onclick="filterCat('HONDA', this)">HONDA</button>
    <button onclick="filterCat('YAMAHA', this)">YAMAHA</button>
    <button onclick="filterCat('SUZUKI', this)">SUZUKI</button>
    <button onclick="filterCat('KAWASAKI', this)">KAWASAKI</button>
</nav>

<div class="container">
    <div id="product-list"></div>
</div>

<a href="#" class="fab" onclick="tambahProduk()">+ INPUT</a>

<script>
    let db;
    let currentCategory = 'HONDA';

    async function initDb() {
        try {
            const SQL = await initSqlJs({ locateFile: file => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.10.3/${file}` });
            const savedData = localStorage.getItem('stok_db');
            if (savedData) {
                db = new SQL.Database(new Uint8Array(JSON.parse(savedData)));
            } else {
                db = new SQL.Database();
                db.run("CREATE TABLE produk (id INTEGER PRIMARY KEY AUTOINCREMENT, nama TEXT, kategori TEXT, stok INTEGER, foto TEXT)");
            }
            tampilkanProduk();
        } catch (e) { console.error(e); }
    }

    function filterCat(cat, btn) {
        currentCategory = cat;
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        tampilkanProduk();
    }

    function tampilkanProduk() {
        const list = document.getElementById('product-list');
        list.innerHTML = '';
        const res = db.exec("SELECT * FROM produk WHERE kategori = ?", [currentCategory]);
        if (res.length > 0) {
            res[0].values.forEach(row => {
                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `
                    <img src="${row[4] || 'https://via.placeholder.com/60'}">
                    <div class="info">
                        <h3>${row[1]}</h3>
                        <p>Stok: ${row[3]}</p>
                    </div>
                    <div class="actions">
                        <button class="btn-edit" onclick="editProduk(${row[0]})">EDIT</button>
                        <button class="btn-hapus" onclick="hapusProduk(${row[0]})">HAPUS</button>
                    </div>
                `;
                list.appendChild(div);
            });
        }
    }

    function hapusProduk(id) {
        if (confirm("Hapus barang ini?")) {
            db.run("DELETE FROM produk WHERE id = ?", [id]);
            const data = db.export();
            localStorage.setItem('stok_db', JSON.stringify(Array.from(data)));
            tampilkanProduk();
        }
    }

    function tambahProduk() {
        const n = prompt("Nama barang:");
        if(n) {
            db.run("INSERT INTO produk (nama, kategori, stok) VALUES (?, ?, 0)", [n, currentCategory]);
            const data = db.export();
            localStorage.setItem('stok_db', JSON.stringify(Array.from(data)));
            tampilkanProduk();
        }
    }

    function editProduk(id) {
        const n = prompt("Nama baru:");
        if(n) {
            db.run("UPDATE produk SET nama = ? WHERE id = ?", [n, id]);
            const data = db.export();
            localStorage.setItem('stok_db', JSON.stringify(Array.from(data)));
            tampilkanProduk();
        }
    }

    initDb();
</script>
</body>
</html>
